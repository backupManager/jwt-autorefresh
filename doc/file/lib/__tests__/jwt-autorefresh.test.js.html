<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">lib/__tests__/jwt-autorefresh.test.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/cchamberlain/jwt-autorefresh" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-autorefresh">autorefresh</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/__tests__/jwt-autorefresh.test.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { encode, decode } from &apos;jwt-simple&apos;
import autorefresh from &apos;../&apos;

const SECRET = &apos;xxx&apos;
const REQUIRED_CLAIMS = [ &apos;nbf&apos;, &apos;exp&apos; ]
const RECOMMENDED_CLAIMS = [ &apos;sub&apos;, &apos;aud&apos; ]

const generate = () =&gt; {
  const nbf = Date.now() / 1000
  const claimsPass = [{ nbf, exp: nbf + 1 }, { nbf, exp: nbf + 10 }, { nbf, exp: nbf + 100 }]

  const claimsFail =  [ { nbf, exp: nbf - 100 }
                      , { nbf: Date.now() / 100, exp: Date.now() / 100 - 1 }
                      , { nbf: Date.now() / 10, exp: Date.now() / 10 }
                      , { nbf: Date.now() * -1, exp: Date.now() * -1 + 1 }
                      ]


  const jwtPass = claimsPass.map(x =&gt; encode(x, SECRET))
  const jwtFail = claimsFail.map(x =&gt; encode(x, SECRET))
  const refreshPass = jwtPass.map(x =&gt; () =&gt; Promise.resolve(x))
  const refreshFail = jwtFail.map(x =&gt; () =&gt; { throw new Error(&apos;BAD REFRESH&apos;)})
  const leadSecondsPass = [10, () =&gt; 100]
  const leadSecondsFail = [-10, () =&gt; -1]
  return { nbf, claimsPass, claimsFail, jwtPass, jwtFail, refreshPass, refreshFail, leadSecondsPass, leadSecondsFail }
}

describe(&apos;autorefresh&apos;, () =&gt; {
  let data = null
  beforeEach(() =&gt; { data = generate() })
  afterEach(() =&gt; { data = null })

  it(&apos;is a function&apos;, () =&gt; expect(autorefresh).toEqual(jasmine.any(Function)))
  it(&apos;with no params throws&apos;, () =&gt; expect(() =&gt; autorefresh()).toThrow())

  it(&apos;with no refresh throws&apos;, () =&gt; {
    const {leadSecondsPass} = data
    const [leadSeconds] = leadSecondsPass
    expect(() =&gt; autorefresh({ leadSeconds })).toThrow()
  })

  it(&apos;with no leadSeconds throws&apos;, () =&gt; {
    const {refreshPass} = data
    const [refresh] = refreshPass
    expect(() =&gt; autorefresh({ refresh })).toThrow()
  })

  it(&apos;with valid params returns function&apos;, () =&gt; {
    const {refreshPass, leadSecondsPass} = data
    const [refresh] = refreshPass
    const [leadSeconds] = leadSecondsPass
    expect(autorefresh({ refresh, leadSeconds })).toEqual(jasmine.any(Function))
  })

  it(&apos;start thunk with bad refresh throws&apos;, () =&gt; {
    const {refreshFail, leadSecondsPass, jwtPass} = data
    const [refresh] = refreshFail
    const [leadSeconds] = leadSecondsPass
    const [access_token] = jwtPass
    expect(() =&gt; autorefresh({ refresh, leadSeconds })(access_token)).toThrow()
  })

  it(&apos;start thunk with bad lead seconds throws&apos;, () =&gt; {
    const {refreshPass, leadSecondsFail, jwtPass} = data
    const [refresh] = refreshPass
    const [leadSeconds] = leadSecondsFail
    const [access_token] = jwtPass
    expect(() =&gt; autorefresh({ refresh, leadSeconds })(access_token)).toThrow()
  })

  it(&apos;start thunk throws for invalid token&apos;, () =&gt; {
    const {refreshPass, leadSecondsPass, jwtFail} = data
    const [refresh] = refreshPass
    const [leadSeconds] = leadSecondsPass
    const [access_token] = jwtFail
    expect(() =&gt; autorefresh({ refresh, leadSeconds })(access_token)).toThrow()
  })

  it(&apos;start thunk returns cancel function for valid token&apos;, () =&gt; {
    const {refreshPass, leadSecondsPass, jwtPass} = data
    const [refresh] = refreshPass
    const [leadSeconds] = leadSecondsPass
    const [access_token] = jwtPass
    expect(autorefresh({ refresh, leadSeconds })(access_token)).toEqual(jasmine.any(Function))
  })

  it(&apos;start thunk returns cancel function that returns falsy&apos;, () =&gt; {
    const {refreshPass, leadSecondsPass, jwtPass} = data
    const [refresh] = refreshPass
    const [leadSeconds] = leadSecondsPass
    const [access_token] = jwtPass
    expect(autorefresh({ refresh, leadSeconds })(access_token)()).toBeFalsy()
  })
})
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
